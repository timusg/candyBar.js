(function(){var jade=function(e){function t(e){return e!=null}return Array.isArray||(Array.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),e.merge=function(n,r){var i=n["class"],s=r["class"];if(i||s)i=i||[],s=s||[],Array.isArray(i)||(i=[i]),Array.isArray(s)||(s=[s]),i=i.filter(t),s=s.filter(t),n["class"]=i.concat(s).join(" ");for(var o in r)o!="class"&&(n[o]=r[o]);return n},e.attrs=function(n,r){var i=[],s=n.terse;delete n.terse;var o=Object.keys(n),u=o.length;if(u){i.push("");for(var a=0;a<u;++a){var f=o[a],l=n[f];"boolean"==typeof l||null==l?l&&(s?i.push(f):i.push(f+'="'+f+'"')):0==f.indexOf("data")&&"string"!=typeof l?i.push(f+"='"+JSON.stringify(l)+"'"):"class"==f&&Array.isArray(l)?i.push(f+'="'+e.escape(l.join(" "))+'"'):r&&r[f]?i.push(f+'="'+e.escape(l)+'"'):i.push(f+'="'+l+'"')}}return i.join(" ")},e.escape=function(t){return String(t).replace(/&(?!(\w+|\#\d+);)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.rethrow=function(t,n,r){if(!n)throw t;var i=3,s=require("fs").readFileSync(n,"utf8"),o=s.split("\n"),u=Math.max(r-i,0),a=Math.min(o.length,r+i),i=o.slice(u,a).map(function(e,t){var n=t+u+1;return(n==r?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+r+"\n"+i+"\n\n"+t.message,t},e}({}),template=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp,__indent=[];buf.push('\n<div id="callStatus"><img'),buf.push(attrs({src:locals.picUrl,"class":"callerAvatar"},{src:!0})),buf.push('/>\n  <h1 class="callerName">');var __val__=locals.caller;buf.push(escape(null==__val__?"":__val__)),buf.push('</h1>\n  <h2 class="callerNumber">');var __val__=locals.caller;buf.push(escape(null==__val__?"":__val__)),buf.push('</h2>\n  <h2 class="callTime">0:00:00</h2>\n  <div class="callActions">\n    <button class="answer">Answer</button>\n    <button class="ignore">Ignore</button>\n    <button class="end">End Call</button>\n    <button class="take">Take Call</button>\n    <button class="push">Push Call</button>\n    <button class="addParty">Add Party</button>\n    <button class="mute">Mute</button>\n    <button class="hold">Hold</button>\n  </div>\n</div>')}return buf.join("")},CandyBar=function(e){this.states={incoming:{buttons:["answer","ignore"]},calling:{buttons:["cancel"]},active:{buttons:["hangup","mute","push"],timer:!0},muted:{buttons:["hangup","unmute"],timer:!0},inactive:{buttons:[],clearUser:!0,hidden:!0},remote:{buttons:["take"]},ending:{buttons:[]},waiting:{buttons:[]}},this.config={defaultName:"Unknown",defaultNumber:"unknown"}};CandyBar.prototype.render=function(){return this.dom?this.dom.innerHTML=this.domify(template(this)).innerHTML:(this.dom=this.domify(template(this)),this.addButtonHandlers(),document.body.insertBefore(this.dom,document.body.firstChild)),this.clearUser(),this.dom},CandyBar.prototype.addButtonHandlers=function(){this.dom.addEventListener("click",function(e){var t=e.target;if(t.tagname==="BUTTON")return this[t.className]&&this[t.className](),!1},!0)},CandyBar.prototype.getStates=function(){return Object.keys(this.states)},CandyBar.prototype.setState=function(e){if(!this.dom)return;var t=this.dom.querySelectorAll("button"),n=this,r=this.states[e],i=Array.prototype.forEach;if(!r)throw new Error("Invalid value for CandyBar state. Valid values are: "+this.getStates().join(", "));this.getStates().forEach(function(e){n.dom.classList.remove(e)}),n.dom.classList.add(e),r.hidden?(n.dom.classList.remove("visible"),document.body.classList.remove("candybarVisible")):(n.dom.classList.add("visible"),document.body.classList.add("candybarVisible")),i.call(t,function(e){r.buttons.indexOf(e.className)!==-1?e.style.display="block":e.style.display="none"}),r.timer?this.timerStopped&&this.startTimer():this.resetTimer(),r.clearUser&&this.setUser({})},CandyBar.prototype.endGently=function(e){var t=this;this.setState("ending"),setTimeout(function(){t.dom.classList.remove("visible"),setTimeout(function(){t.setState("inactive"),t.clearUser()},1e3)},1e3)},CandyBar.prototype.getUser=function(){var e=this.user||{};return{picUrl:e.picUrl,name:e.name&&e.name||this.config.defaultName,number:e.number&&escape(e.number)||this.config.defaultNumber}},CandyBar.prototype.setUser=function(e){this.user=e;if(!this.dom)return;var t=this.getUser();this.dom.querySelector(".callerAvatar").src=t.picUrl,this.dom.querySelector(".callerNumber").innerHTML=t.number,this.dom.querySelector(".callerName").innerHTML=t.name,t.picUrl?this.dom.classList.add("havatar"):this.dom.classList.remove("havatar")},CandyBar.prototype.clearUser=function(){this.setUser({picUrl:"",name:"",number:""})},CandyBar.prototype.domify=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},CandyBar.prototype.startTimer=function(){this.timerStartTime=Date.now(),this.timerStopped=!1,this.updateTimer()},CandyBar.prototype.stopTimer=function(){this.timerStopped=!0},CandyBar.prototype.resetTimer=function(){this.timerStopped=!0,this.setTimeInDom("0:00:00")},CandyBar.prototype.updateTimer=function(){if(this.timerStopped)return;var e=Date.now()-this.timerStartTime,t=Math.floor(e/1e3)%60,n=Math.floor(e/1e3/60)%60,r=Math.floor(e/1e3/60/60)%60,i=[r,this.zeroPad(n),this.zeroPad(t)].join(":");this.time!==i&&(this.time=i,this.setTimeInDom(i)),setTimeout(this.updateTimer.bind(this),100)},CandyBar.prototype.setTimeInDom=function(e){if(!this.dom)return;this.dom.querySelector(".callTime").innerHTML=e},CandyBar.prototype.zeroPad=function(e){return(e+"").length===1?"0"+e:e},window.CandyBar=CandyBar})(window)